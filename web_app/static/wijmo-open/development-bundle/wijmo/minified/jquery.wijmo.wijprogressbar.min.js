/*
 *
 * Wijmo Library 1.4.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";var b="wijmo-wijprogressbar",j="ui-progressbar",i=j+"-label",c=b+"-lb-",d="ui-corner-",g=d+"left",f=d+"right",h=d+"top",e=d+"bottom";a.widget("wijmo.wijprogressbar",a.ui.progressbar,{options:{labelAlign:"center",maxValue:100,minValue:0,fillDirection:"east",labelFormatString:"{1}%",toolTipFormatString:"{1}%",indicatorIncrement:1,indicatorImage:"",animationDelay:0,animationOptions:{disabled:false,easing:null,duration:500},progressChanging:null,beforeProgressChanging:null,progressChanged:null},_setOption:function(c,d){var b=this,e=b.options,f;switch(c){case"value":e[c]=parseInt(d,10);b._refreshValue();return;case"maxValue":e.max=d;case"minValue":f=parseInt(d,10);e[c]=f;b[c==="maxValue"?"max":"min"]=f;b._refreshValue(true);return;case"labelFormatString":case"toolTipFormatString":e[c]=d;b._refreshValue(true);return;case"fillDirection":case"labelAlign":case"indicatorImage":e[c]=d;b._updateElementsCss();return}a.Widget.prototype._setOption.apply(b,arguments);c==="disabled"&&b._handleDisabledOption(d,b.element)},_create:function(){var c=this,d=c.options,e=c.element;c.directions={east:"left",west:"right",north:"bottom",south:"top"};c.min=d.minValue;c.max=d.maxValue;e.addClass(b);a.ui.progressbar.prototype._create.apply(c,arguments);c.label=a("<span>").addClass(i).appendTo(e);c._updateElementsCss();c._isInit=true;d.disabled&&c.disable();c._refreshValue()},_handleDisabledOption:function(b,c){var a=this;if(b){if(!a.disabledDiv)a.disabledDiv=a._createDisabledDiv(c);a.disabledDiv.appendTo("body")}else if(a.disabledDiv){a.disabledDiv.remove();a.disabledDiv=null}},_createDisabledDiv:function(d){var g=this,b=d?d:g.element,c=b.offset(),f=b.outerWidth(),e=b.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:f,height:e,left:c.left,top:c.top})},_triggerEvent:function(a,c,b){return this._trigger(a,null,{oldValue:c,newValue:b})===false},_refreshValue:function(i){var b=this,g=b.options,f=g.animationOptions,h=b.element,c,e,d;if(!b._isInit)return;d=h.attr("aria-valuenow");c=b.value();e=(c-b.min)/(b.max-b.min)*100;if(b._triggerEvent("beforeProgressChanging",d,c))return;if(!f.disabled&&f.duration>0)setTimeout(function(){a.wijmo.wijprogressbar.animations.progress({content:b.valueDiv,complete:function(){b._triggerEvent("progressChanged",d,c)},step:function(a){b._performAnimating(a,i)},progressValue:e},f)},g.animationDelay);else{b._refreshProgress(Math.round(e));b._lastStep=e;b._triggerEvent("progressChanged",d,c)}},_refreshProgress:function(c){var a=this,d=a.options,i=d.fillDirection,j=a.element,b=c*(a.max-a.min)/100+a.min;if(a._triggerEvent("progressChanging",j.attr("aria-valuenow"),b))return;if(a._isHorizontal())a.valueDiv.toggleClass(i==="east"?f:g,b===a.max).width(c+"%");else a.valueDiv.toggleClass(i==="south"?e:h,b===a.max).height(c+"%");a.label.html(a._getFormatString(d.labelFormatString,c,b));j.attr("aria-valuenow",b).attr("title",a._getFormatString(d.toolTipFormatString,c,b))},_isHorizontal:function(){var a=this.options.fillDirection;return a==="west"||a==="east"},_getRotateTextOffset:function(a){var c,b;a.css("width","auto");c=a.outerWidth();b=a.outerHeight();a.css("width","");return Math.max(c-b-4,0)},_updateElementsCss:function(){var a=this,e=a.options,d=a.element,c=e.fillDirection;d.removeClass(b+"-west "+b+"-east "+b+"-north "+b+"-south").addClass(b+"-"+c);a._updateProgressCss();a._updateLabelCss()},_updateLabelCss:function(){var d=this,i=d.options,h=d.element,b=i.labelAlign,e=d.label,g=d._lastStep,f=h.height();e.removeClass(c+"west "+c+"east "+c+"south "+c+"north "+c+"center "+c+"running").addClass(c+b).css({left:"",right:"",top:"",bottom:"",width:"","text-align":"","line-height":""});b!=="north"&&b!=="south"&&!(b==="running"&&!d._isHorizontal())&&e.css("line-height",f+"px");if(b==="running")d._updateRunningLabelCss(g);else if(!d._isHorizontal()&&!a.browser.msie)if(b==="north")e.css("width","100%").css("line-height",f+"px").css("text-align","right");else b==="south"&&e.css("width","100%").css("line-height",f+"px").css("text-align","left")},_updateRunningLabelCss:function(l){var b=this,m=b.options,i=m.fillDirection,k=b.element,f=b.label,j=b.valueDiv,e=b._isHorizontal(),c,d,g,h;c=k[e?"width":"height"]();d=f[e?"outerWidth":"outerHeight"]();g=j[e?"outerWidth":"outerHeight"]();if(!e&&!a.browser.msie)d+=b._getRotateTextOffset(f);h=c===g?c-d:l*c/100-d+d*(c-g)/c;f.css(b.directions[i],h)},_updateProgressCss:function(){var b=this,j=b.options,k=j.fillDirection,i=j.indicatorImage,a=b.valueDiv,c=b._lastStep;i!==""&&a.css("background","transparent url("+i+") repeat fixed");a.removeClass(g+" "+f+" "+h+" "+e).addClass(d+b.directions[k]);if(c)if(b._isHorizontal())a.css("width",c+"%").css("height","");else a.css("height",c+"%").css("width","");else a.css({width:"",height:""})},_performAnimating:function(a,e){var b=this,d=b.options,c=d.indicatorIncrement;if(c!==1)a=Math.floor(a/c)*c;else a=Math.round(a);if(b._lastStep===a&&!e)return;b._lastStep=a;b._refreshProgress(a);d.labelAlign==="running"&&b._updateRunningLabelCss(a)},_getFormatString:function(a,d,e){var c=this,g=c.max-e,f=100-d,b=/\{0\}/g;a=a.replace(b,e.toString());b=/\{ProgressValue\}/g;a=a.replace(b,e.toString());b=/\{1\}/g;a=a.replace(b,d.toString());b=/\{PercentProgress\}/g;a=a.replace(b,d.toString());b=/\{2\}/g;a=a.replace(b,g.toString());b=/\{RemainingProgress\}/g;a=a.replace(b,g.toString());b=/\{3\}/g;a=a.replace(b,f.toString());b=/\{PercentageRemaining\}/g;a=a.replace(b,f.toString());b=/\{4\}/g;a=a.replace(b,c.min);b=/\{Min\}/g;a=a.replace(b,c.min);b=/\{5\}/g;a=a.replace(b,c.max);b=/\{Max\}/g;a=a.replace(b,c.max);return a},destroy:function(){var c=this,d=c.element;d.empty().attr("aria-valuemax","").attr("aria-valuemin","").attr("aria-valuenow","").attr("title","").attr("role","").removeClass(b+" "+b+"-east "+b+"-west "+b+"-north "+b+"-south");if(c.disabledDiv){c.disabledDiv.remove();c.disabledDiv=null}a.Widget.prototype.destroy.apply(this,arguments)}});a.extend(a.wijmo.wijprogressbar,{animations:{progress:function(b,c){b=a.extend({easing:"swing",duration:1e3},b,c);b.content.stop(true,true).animate({pgvalue:b.progressValue},b)}}})})(jQuery);